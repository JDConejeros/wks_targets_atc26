---
title: "Flujo de trabajo reproducible con R y {targets}"
subtitle: "Laboratorio Abre Tu Ciencia <br> ![](Images/logo_targets.svg){width=15%}"
author: "Jos√© Daniel Conejeros, Msc."
date: today 
date-format: long
lang: es
format:
  revealjs:
    theme: [default, custom.scss]
    slide-number: true
    slide-number-style: [bottom-right]
    progress: true
    transition: fade
    background-transition: fade
    transition-speed: fast
    logo: "Images/ATC26.png"
    footer: '<i class="fa fa-envelope"></i> <jdconejeros@uc.cl> | <i class="fab fa-github"></i> [JDConejeros](https://github.com/JDConejeros) | ATC 2026 | ¬© Hecho en <a href="https://quarto.org/">Quarto <i class="fa fa-mug-hot"></i></a>'
    html-math-method: mathjax
    preview-links: true
    code-fold: true
    code-tools: true
    highlight-style: github
    fig-width: 10
    fig-height: 6
    fig-dpi: 300
---



## Hoy hablaremos sobre


:::: {.columns}

::: {.column width="60%"}
<br>

- Automatizaci√≥n de `workflows`
- Introducci√≥n de `targets` en R

Link al material:  <a href="https://github.com/JDConejeros/wks_targets_atc26" class="btn btn-primary" style="background-color: #238636; color: white; padding: 5px 10px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
  <i class="fab fa-github"></i> C√≥digo
</a>

:::

::: {.column width="40%"}
<div style="width:100%;height:0;padding-bottom:100%;position:relative;"><iframe src="https://giphy.com/embed/XdDsb6psTES0eQo8Vg" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe></div><p></p>
:::

::::

::: {.callout-note}
*En Python el proceso es an√°logo con [snakemake](https://snakemake.readthedocs.io/en/stable/tutorial/interaction_visualization_reporting/tutorial.html).*

:::


## ¬øPor qu√© automatizar un flujo?

Por **workflow** o flujo de trabajo nos referimos a la serie de pasos para llevar a cabo un an√°lisis de datos.

- Reproducibilidad: Obtener resultados utilizando los mismos datos de entrada, pasos computacionales, m√©todos, c√≥digo y condiciones de an√°lisis.

Pero adem√°s:

- Eficiencia. 
- Escalabilidad.
- Mantenimiento. 

## Desaf√≠os de la reproducibilidad

1. Directorios/rutas de trabajo.
2. Paquetes y versionamiento.
3. Pipeline o flujo poco claro.
4. Sin informaci√≥n de dependencias.
5. Cambios en el c√≥digo. 


## Targets 

:::: {.columns}

::: {.column width="30%"}
![](Images/logo_targets.svg){width=70%} 
:::

::: {.column width="70%"}
El paquete `targets` es una herramienta de pipeline para R enfocada en an√°lisis estad√≠stico y ciencia de datos: coordina una serie de pasos computacionales (llamados *targets*) y, al igual que otros sistemas de flujo de trabajo, evita recalcular pasos cuyos datos o c√≥digo no han cambiado, lo que ahorra tiempo y mejora la reproducibilidad de proyectos complejos. 


:::

::::



Cada *target* representa una tarea definida por funciones de R, y la estructura de dependencias entre ellos forma un gr√°fico ac√≠clico dirigido (DAG) que targets utiliza para decidir qu√© ejecutar y qu√© saltarse. 

Puedes ver toda la documentaci√≥n aqu√≠: <a href="https://books.ropensci.org/targets/" class="btn btn-primary" style="background-color: #2c5282; color: white; padding: 5px 10px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
  <i class="fab fa-github"></i> Manual
</a> <a href="https://docs.ropensci.org/targets/" class="btn btn-primary" style="background-color: #238636; color: white; padding: 5px 10px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
  <i class="fab fa-github"></i> Repositorio
</a>

## ¬øPor qu√© targets?

![](Images/notebook-dilemma.png){fig-align="center"}

¬øQu√© debo volver a correr?, ¬øpuedo saltarme pasos para ahorrar tiempo?, ¬øqu√© modelos espec√≠ficos se ven afectados?, ¬øtengo que rehacer todo para garantizar reproducibilidad?

## Targets

La filosof√≠a del paquete impulsa un estilo de programaci√≥n **orientado a funciones dentro de R**, promueve reproducibilidad al abstraer archivos como objetos de R y facilita paralelizaci√≥n impl√≠cita, lo que permite construir an√°lisis eficientemente, mantenerlos organizados y asegurar que los resultados sean coherentes con el c√≥digo y los datos actuales

Algunas alternativas:

- Paquete [drake](https://docs.ropensci.org/drake/) (antecesor de targets).
- Paquete [workflowr](https://workflowr.github.io/workflowr/) (no gestiona dependencias).  

## Targets

![](Images/pipeline_graph.png){fig-align="center"}


1. Actualiza solo lo necesario. 
2. C√°lculos escalables.
3. Gestiona los datos de salida.

## Targets

**Principales funciones de trabajo**:

1.  Definici√≥n del pipeline:

	- `tar_pipeline()`: define el pipeline completo como una colecci√≥n de targets.
	- `tar_target()`: **define un paso del pipeline (un objeto o resultado a producir)**.
	- `tar_option_set()`: define opciones globales del pipeline (paquetes, formato, recursos).
	- `tar_source()`: carga archivos R con funciones o targets auxiliares.

## Targets

**Principales funciones de trabajo**:

2. Ejecuci√≥n y control: 

	- `tar_make()`: **ejecuta el pipeline, corriendo solo lo que est√° desactualizado**.
	- `tar_make_clustermq()`: ejecuta el pipeline en paralelo usando clustermq.
	- `tar_make_future()`: ejecuta el pipeline en paralelo usando future.
	- `tar_destroy()`: borra el estado del pipeline y la cache.
	- `tar_prune()`: elimina targets obsoletos de la cache.

## Targets

**Principales funciones de trabajo**:

3.  Inspecci√≥n y diagn√≥stico: 

	- `tar_visnetwork()`: visualiza el DAG del pipeline.
	- `tar_glimpse()`: muestra un resumen r√°pido de los targets.
	- `tar_progress()`: muestra el progreso de ejecuci√≥n.
	- `tar_outdated()`: identifica qu√© targets necesitan re‚Äêejecutarse.
	- `tar_meta()`: inspecciona metadatos de los targets.
	- `tar_manifest()`: lista todos los targets definidos.

## Targets

**Principales funciones de trabajo**:

4.  Branching (reemplaza loops manuales por paralelizaci√≥n declarativa): 

	- `tar_map()`: define branching din√°mico a partir de una lista o vector.
	- `tar_combine()`: combina los resultados de m√∫ltiples ramas en un solo target.
	- `tar_group()`: agrupa ramas para control de ejecuci√≥n.
	- `tar_rep()`: replica un target m√∫ltiples veces (√∫til para simulaciones).

## Targets

**Principales funciones de trabajo**:

5. Reportes y comunicaci√≥n:

	- `tar_render()`: renderiza documentos Quarto/R Markdown como parte del pipeline.
	- `tar_quarto()`: renderiza documentos Quarto (.qmd) integrados al pipeline.
	- `tar_read()`: recupera el valor de un target ya calculado.
	- `tar_load()`: carga targets directamente en el entorno de R.

## Recomendaciones iniciales

- Empieza con proyectos peque√±os.
- Aunque tome m√°s tiempo, incorpora estas herramientas desde el inicio.
- Tal vez cambie un poco tu forma de trabajar, pero los beneficios valen la pena.
- Consulta la documentaci√≥n oficial y ejemplos en l√≠nea:  <a href="https://books.ropensci.org/targets/" class="btn btn-primary" style="background-color: #2c5282; color: white; padding: 5px 10px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
  <i class="fab fa-github"></i> Intro a Targets </a>

## Universo Targets

<br>

![](Images/targetopia.png){fig-align="center" style="max-width:70%" style="max-height:70%"}

üîó [https://wlandau.github.io/targetopia/packages.html](https://wlandau.github.io/targetopia/packages.html)



## Recomendaciones joya

- Estructura de proyectos por Danielle Navarro: üîó [Slides](https://djnavarro.net/slides-project-structure/#1)
- Ciencia Reproducible por Dan Ovando: üîó [Slides](https://danovando.github.io/reproducible-workflow/presentations/reproducibility-101#1)
- Proyectos Buenos por Barbara Vreede: üîó [Repositorio](https://github.com/bvreede/good-enough-project)
- Automatizaci√≥n de workflows en R y Python con targets y snakemake por Diana Garc√≠a Cort√©s: üîó [Repositorio](https://github.com/ddiannae/latinr-targets?tab=readme-ov-file)
- Introducci√≥n a Targets por Will Landau üîó [Slides](https://wlandau.github.io/targets-intro/#/section)
- Protocolos de An√°lisis Reproducible por Lisa: üîó [Website](https://lisacoes.com/protocolos/a-ipo-rep/)


## Manos a los datos

Vamos a utilizar una muestra aleatoria de los datos del art√≠culo acad√©mico:


::: {.callout-note}
Blanco, E., Conejeros, J.D., Gonz√°lez-Reyes, √Å. et al. Heat beyond percentiles: exploring preterm birth risks in Santiago, Chile (1991‚Äì2019). *Int Arch Occup Environ Healt* **99**, 5 (2026). <https://doi.org/10.1007/s00420-025-02196-x>
:::

Puedes acceder a los c√≥digos de este art√≠culo aqu√≠: <a href="https://doi.org/10.5281/zenodo.17316762" class="btn btn-primary" style="background-color: #238636; color: white; padding: 5px 10px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
  <i class="fab fa-github"></i> Repositorio
</a>